function [ output_args ] = runMainCounterfactuals( id )

runRobustnessNoEduc = false;
if id == 1 % Robustness: low substitutability
    x = [1.57649731972029   -0.01661819975197039       0.60901388175876     -4.216927229224722     0.1671854739743654      1.569051989684592   -0.02879616730211453      1.722370918735816      0.928629395088776     0.4053883559795582      1.873253900135576   -0.03509455099631208      2.064095142071198     -6.831780856717671    -0.2663983487112773      1.472896026312841    -0.0698482213831776    -0.4733972468267442      -1.84242218262531     0.6909974475337946      1.487647979114092    -0.4242579593902923     -0.284516914958626     -18.87953537563977     0.3276306691944155      1.918900387677956    0.03673332141813408      1.951943289971694     -7.111145453381952    -0.4979418882987197     0.1490956755482146     0.8985700448581618     -1.097529386392933     -1.217718739826254      6.213756197259666     -7.239118703899402      1.135979204164056     -11.52685222967914      16.55235237918028]';
    gamma = 0.2;
elseif id == 2 % Baseline specification
    x = [1.519483984809266   -0.05746128964018259     0.6345595333994322     -4.840192719706102     0.2748069312196685       1.27676233415676   -0.09986608619501373     0.4674784486931917    -0.2558724996252222     0.5442189398921765      1.863367287023733  0.0006913340565242012      2.018431383085041     -6.397982725196995   -0.05923795416751185       1.47392314513044   -0.09280245819679893    -0.6381696897930241     -1.851903340765297     0.5352884630818725      1.507147147572896    -0.3414143620665406   -0.09618692899202715      -18.9265233194618    0.08373299925924343      1.877114232210329   -0.03766199307480714       2.59402481899324     -7.677164151569853    -0.6339114914213518     0.1428299019156748     0.9277190461179347     -1.238019830127258     -1.267044143094966      6.307463421799779     -7.264891546289503      1.270469152861867     -11.52364482980506      18.08448190532703]';
    gamma = 0.43662;
    runRobustnessNoEduc = true;
elseif id == 3 % Robustness: high substitutability
    x = [1.546032861426927  -0.004855475589172785     0.5052662957626045     -4.305959967449531     0.4026392164299962      1.503545968438277    0.07923288279890837       1.52833151183486      0.795310823509807     0.5513895475854211      1.885071524500625    0.02716253978351155      1.704783792227726     -6.818106255894974     0.1867999280664195      1.549192316228214   -0.03530910949891766    -0.5824567474412536     -1.854871381862015     0.6659781652879871       1.53117016364564    -0.2923610461447342    -0.2898816726700951     -18.90483959361566     0.3848955950544329      1.887657696999137   0.008392250226635489      2.229116667718023     -7.120752123649455    -0.1633041250897394     0.1709229849750468     0.9193586310958968      -1.33366437092343     -1.855606878894153      6.285088741743262     -7.276409163004049      1.288862841744608     -11.51921800970828      17.00008470947836]';
    gamma = 0.56522;
elseif id == 4 % Robustness: sigmaInf = 0.15
    x = [1.620080047266086     0.1121206211125089     0.9896984442929514      -5.07283323968544     0.2215516383614025      1.373211073582007    0.06813848129590099     0.2223334200942927    -0.4344884375773213     0.5559488322602061      1.896516975805631     0.1462269994876174      1.747919803745117     -6.096753626588378   -0.02948469197678871      1.608560862189176     0.1017330615700294     -0.379045664959045     -2.011209142143353        0.5031905085755      1.645477016518648     -0.131030740089798     0.3760551173790828     -18.97497870938465    0.06094198949241621      1.924787402719944     0.1148721873561768         2.554193927219     -7.971102080949475    -0.6088878880383537     0.2805596356508445     0.8727665658414264     -1.021580659484323     -0.773978984292424      6.506438790427888     -7.229372069722277      1.100582390879465     -11.52018150520573       18.3884657400611]';
    gamma = 0.43662;
elseif id == 5 % Robustness: unemp insurance
    x = [1.510993203434194   -0.09193731682685952      1.085209055075825     -5.111154216394799     0.4281818966391581      1.249402220046062    -0.1499787511415227     0.5305047879056561    -0.1660697003721913     0.6170451083143512      1.795843134906112   -0.04685550959958954      2.033473893975585     -6.061582664820468     0.4491361511155916      1.496560392249315    -0.1173750782054109    -0.1166565567013862     -1.624487431425706     0.6277510000322303      1.489419645536887    -0.3804198434862455     0.3015601124237397      -18.8277631162024     0.4127285904261274      1.823219371929103   -0.09611907247909922      2.685149917204133     -8.063581637006303   -0.02991665600968543    0.09995627349135888     0.8887665979464645     -1.173607585120125     -1.129912626127392      6.237799211834197     -7.418528954964003      1.235344866273291     -11.49784710756196      17.56432997438386]';
    gamma = 0.43662;
end
load('../CleanData/moments_regions.mat');
ME = ModelEstimator(moments,V,pmeDataSummary);
if id == 2 %Export table with estimated shares of skilled workers by group
    
end
ME.setAllParameters(x);

diaryFileName = ['cleanOutput/cfMainLog_' num2str(id) '.txt'];
delete(diaryFileName);
diary(diaryFileName);
for i = 1:ME.numRegions
    ME.regionModels{i}.verbosity = 5;
    ME.regionModels{i}.gamma = gamma;
    if id == 4
        ME.regionModels{i}.sigmaInf = 0.15;
    elseif id == 5
        ME.regionModels{i}.bD = - ME.regionModels{i}.bD .* ...
            (ME.regionModels{i}.r./ME.regionModels{i}.lambda_for+1);
    end
end
[results.loss, ~,results.nationalMoments,results.eqs] = ME.estimationObjFun(x,false);
results.nationalTargets = ME.targetMoments((end-2):end);
resultsFile = ['cleanOutput/estMain_' num2str(id) '.mat'];
save(resultsFile,'results','ME');

fprintf('\n\n\nNOW PROCEEDING TO runCounterfactuals\n\n\n');
diary OFF

makeCounterfactuals(resultsFile,...
    ['cleanOutput/cfMain_' num2str(id) '.mat'], ...
    diaryFileName, 0, runRobustnessNoEduc);
end

